<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>DOD – Do Or Die</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#000000" />

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">

<!-- React -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Icons -->
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, update, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyByLeOnstoCGQ9vew1NYXtBe2E_xyUVgDg",
  authDomain: "do-or-die-33610.firebaseapp.com",
  databaseURL: "https://do-or-die-33610-default-rtdb.firebaseio.com",
  projectId: "do-or-die-33610",
};

const app = initializeApp(firebaseConfig);
window.db = getDatabase(app);
window.auth = getAuth(app);
window.ref = ref;
window.set = set;
window.update = update;
window.onValue = onValue;
window.signInAnonymously = signInAnonymously;
window.onAuthStateChanged = onAuthStateChanged;
</script>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        dodPurple: "#A855F7",
        dodGreen: "#22C55E",
        dodBg: "#000000",
        dodCard: "#0B192C",
      },
      fontFamily: {
        sans: ["Roboto"],
        mono: ["Roboto Mono"],
      },
    },
  },
};
</script>

<style>
body { background:#000; color:#e5e7eb; }
.no-scrollbar::-webkit-scrollbar { display:none }
.fade-in { animation: fade .25s ease-out }
@keyframes fade { from {opacity:0; transform:translateY(8px)} to {opacity:1} }
button:active { transform: scale(.97); }
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef, useMemo } = React;

/* ───────────────── STOPWATCH ───────────────── */
const Stopwatch = ({ label, theme }) => {
  const [time, setTime] = useState(0);
  const [run, setRun] = useState(false);
  const refT = useRef(null);

  const toggle = () => {
    if (run) {
      clearInterval(refT.current);
      setTime(0);
      setRun(false);
    } else {
      const start = Date.now();
      refT.current = setInterval(() => setTime(Date.now() - start), 100);
      setRun(true);
    }
  };

  const fmt = ms =>
    `${String(Math.floor(ms / 60000)).padStart(2, "0")}:${String(Math.floor(ms % 60000 / 1000)).padStart(2, "0")}`;

  return (
    <div onClick={toggle}
      className={`flex-1 rounded-[2rem] p-6 cursor-pointer select-none bg-gradient-to-br
      ${theme === "purple" ? "from-dodPurple/30 to-black border-dodPurple/40" : "from-dodGreen/30 to-black border-dodGreen/40"}
      border shadow-xl active:scale-[.96]`}>
      <p className="text-[10px] uppercase tracking-[.3em] font-black text-white/60 text-center">{label}</p>
      <div className="text-center font-mono font-black text-4xl mt-2">{fmt(time)}</div>
      <p className="text-center text-[9px] mt-3 tracking-widest opacity-60">{run ? "RESET" : "START"}</p>
    </div>
  );
};

/* ───────────────── EXERCISE ROW ───────────────── */
const ExerciseRow = ({
  exercise, exIndex, updateExercise, deleteExercise,
  isExpanded, onToggleExpand
}) => {

  const addSet = () =>
    updateExercise(exIndex, { ...exercise, sets: [...(exercise.sets||[]), { weight:"", reps:"" }] });

  const updateSet = (i,f,v) => {
    const s=[...exercise.sets]; s[i][f]=v;
    updateExercise(exIndex,{...exercise,sets:s});
  };

  return (
    <div className="rounded-[2rem] bg-dodCard border border-white/10 shadow-xl">
      <div onClick={onToggleExpand}
        className="p-5 flex justify-between items-center cursor-pointer border-b border-white/10">
        <h3 className="font-black text-lg">{exercise.name||"New Exercise"}</h3>
        <i className={`ph-bold ${isExpanded?"ph-caret-up":"ph-caret-down"} opacity-60`}></i>
      </div>

      {isExpanded && (
        <div className="p-5 space-y-3 fade-in">
          {(exercise.sets||[]).map((s,i)=>(
            <div key={i} className="flex gap-3 items-center">
              <span className="w-6 text-xs opacity-40">{i+1}</span>
              <input type="number" value={s.weight}
                onChange={e=>updateSet(i,"weight",e.target.value)}
                placeholder="kg"
                className="flex-1 bg-black/40 rounded-xl p-2 text-center"/>
              <input type="number" value={s.reps}
                onChange={e=>updateSet(i,"reps",e.target.value)}
                placeholder="reps"
                className="flex-1 bg-black/40 rounded-xl p-2 text-center"/>
            </div>
          ))}

          <button onClick={addSet}
            className="w-full py-3 bg-white/10 rounded-xl text-[10px] font-black tracking-widest">
            + ADD SET
          </button>

          <button onClick={()=>deleteExercise(exIndex)}
            className="w-full py-2 text-red-400 text-xs tracking-widest">
            DELETE EXERCISE
          </button>
        </div>
      )}
    </div>
  );
};

/* ───────────────── WORKOUT LOGGER ───────────────── */
const WorkoutLogger = () => {
  const [exercises,setExercises]=useState([]);
  const [expanded,setExpanded]=useState(-1);
  const [adding,setAdding]=useState(false);
  const [name,setName]=useState("");

  const addExercise=()=>{
    if(!name.trim())return;
    setExercises([...exercises,{name,sets:[]}]);
    setExpanded(exercises.length);
    setName(""); setAdding(false);
  };

  return (
    <div className="max-w-md mx-auto px-4 pb-40 space-y-5">
      <div className="flex gap-3">
        <Stopwatch label="ME" theme="purple"/>
        <Stopwatch label="PARTNER" theme="green"/>
      </div>

      {exercises.map((ex,i)=>(
        <ExerciseRow key={i}
          exercise={ex}
          exIndex={i}
          updateExercise={(idx,val)=>{
            const l=[...exercises]; l[idx]=val; setExercises(l);
          }}
          deleteExercise={i=>{
            setExercises(exercises.filter((_,x)=>x!==i));
          }}
          isExpanded={expanded===i}
          onToggleExpand={()=>setExpanded(expanded===i?-1:i)}
        />
      ))}

      <button onClick={()=>setAdding(true)}
        className="fixed bottom-6 right-6 w-16 h-16 rounded-full bg-dodPurple shadow-2xl flex items-center justify-center">
        <i className="ph-bold ph-plus text-2xl"></i>
      </button>

      {adding && (
        <div className="fixed inset-0 bg-black/70 flex items-end justify-center p-4">
          <div className="bg-dodCard rounded-[2rem] p-6 w-full max-w-md">
            <input autoFocus value={name} onChange={e=>setName(e.target.value)}
              placeholder="Exercise name"
              className="w-full p-4 rounded-xl bg-black/40 text-white font-black"/>
            <button onClick={addExercise}
              className="w-full mt-4 py-4 rounded-xl bg-dodPurple font-black tracking-widest">
              ADD
            </button>
          </div>
        </div>
      )}
    </div>
  );
};

ReactDOM.createRoot(document.getElementById("root")).render(<WorkoutLogger />);
</script>
</body>
</html>
